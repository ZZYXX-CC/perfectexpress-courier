module.exports=[31726,a=>{"use strict";var b=a.i(37936),c=a.i(22176),d=a.i(18558);async function e(a,b){let d=await (0,c.createClient)(),{data:{user:e}}=await d.auth.getUser(),{data:f,error:g}=await d.from("chat_sessions").insert({visitor_name:a,visitor_email:b,user_id:e?.id||null,status:"active"}).select().single();return g?(console.error("Error creating chat session:",g),{error:g.message}):{success:!0,session:f}}async function f(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("chat_sessions").select("*").eq("id",a).single();return e?(console.error("Error fetching chat session:",e),null):d}async function g(){let a=await (0,c.createClient)(),{data:b,error:d}=await a.from("chat_sessions").select("*").order("last_message_at",{ascending:!1});return d?(console.error("Error fetching chat sessions:",d),[]):b}async function h(a,b,d,e){let f=await (0,c.createClient)(),{data:g,error:h}=await f.from("chat_messages").insert({session_id:a,sender_type:d,sender_name:e,message:b}).select().single();return h?(console.error("Error sending message:",h),{error:h.message}):{success:!0,message:g}}async function i(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("chat_messages").select("*").eq("session_id",a).order("created_at",{ascending:!0});return e?(console.error("Error fetching messages:",e),[]):d}async function j(a){let b=await (0,c.createClient)(),{error:e}=await b.from("chat_sessions").update({status:"closed",updated_at:new Date().toISOString()}).eq("id",a);return e?(console.error("Error closing chat session:",e),{error:e.message}):((0,d.revalidatePath)("/admin/chat"),{success:!0})}async function k(a){let b=await (0,c.createClient)();return await b.from("chat_messages").update({is_read:!0}).eq("session_id",a).eq("sender_type","visitor").eq("is_read",!1),await b.from("chat_sessions").update({unread_count:0}).eq("id",a),{success:!0}}(0,a.i(13095).ensureServerEntryExports)([e,f,g,h,i,j,k]),(0,b.registerServerReference)(e,"601a54e1e61ebec4ee8d22d385482431483c383d59",null),(0,b.registerServerReference)(f,"40ae27ffaf22b8950880e72d49cdd11a2f48da0940",null),(0,b.registerServerReference)(g,"009a18ceb083bab5ad24884d10753cc89c6b893002",null),(0,b.registerServerReference)(h,"781dce578e8850f3344c600f141f5999ba6b9b7064",null),(0,b.registerServerReference)(i,"4025a0ee08735742c2e4d64b5ee759f70a786392ad",null),(0,b.registerServerReference)(j,"40ceed2991eeb6f8616fabb5f58d0ee2f68e273e4d",null),(0,b.registerServerReference)(k,"40007ca5d3341f9372d0ec690a3592d7880edcaa5e",null),a.s(["closeChatSession",()=>j,"createChatSession",()=>e,"getActiveChatSessions",()=>g,"getChatMessages",()=>i,"markMessagesAsRead",()=>k,"sendChatMessage",()=>h])},43908,a=>{"use strict";var b=a.i(37936),c=a.i(22176);async function d(b){let d=await (0,c.createClient)(),{data:{user:e}}=await d.auth.getUser(),{data:f,error:g}=await d.from("shipments").insert({user_id:e?.id||null,sender_info:{name:b.sender_name,email:b.sender_email,address:b.sender_address},receiver_info:{name:b.receiver_name,email:b.receiver_email,address:b.receiver_address},parcel_details:{description:b.parcel_description,weight:b.parcel_weight},status:"pending",payment_status:"unpaid",history:[{status:"pending",location:"System",timestamp:new Date().toISOString(),note:"Shipment created"}]}).select().single();if(g)return console.error("Error creating shipment:",g),{error:"Failed to create shipment. Please try again."};try{let{sendShipmentCreatedEmail:c,sendShipmentReceiverNotification:d}=await a.A(74019);await c(b.sender_email,f?.tracking_number||"N/A",b.sender_name),b.receiver_email&&await d(b.receiver_email,f?.tracking_number||"N/A",b.receiver_name,b.sender_name)}catch(a){console.error("Failed to send creation email:",a)}return{success:!0,tracking_number:f.tracking_number}}(0,a.i(13095).ensureServerEntryExports)([d]),(0,b.registerServerReference)(d,"4023fc5c56a08eded849c2b60f98760867ea10f3a0",null),a.s(["createShipment",()=>d])},69973,a=>{"use strict";var b=a.i(31726),c=a.i(37936),d=a.i(22176),e=a.i(18558);async function f(a=100){let b=await (0,d.createClient)(),{data:c,error:e}=await b.from("shipments").select("id, tracking_number, sender_info, receiver_info, parcel_details, status, payment_status, current_location, history, created_at, price").order("created_at",{ascending:!1}).limit(a);return e?(console.error("Error fetching shipments:",e),[]):c}async function g(b,c){let f=await (0,d.createClient)();"confirmed"===c.status&&(c.payment_status="paid");let{error:g}=await f.from("shipments").update({...c,updated_at:new Date().toISOString()}).eq("id",b);if(g)return console.error("Error updating shipment:",g.message,g.code),{error:`Failed to update shipment: ${g.message}`};try{let{data:d}=await f.from("shipments").select("*").eq("id",b).single();if(d){let{sendShipmentApprovedEmail:b,sendShipmentDispatchedEmail:e,sendShipmentDeliveredEmail:f,sendPaymentConfirmedEmail:g}=await a.A(74019),h=d.sender_info?.email,i=d.receiver_info?.email,j=d.sender_info?.name||"Customer",k=d.receiver_info?.name||"Customer",l=[h,i].filter(Boolean);if(c.price&&!d.price)for(let a of l)await b(a,d.tracking_number,c.price);if("confirmed"===c.status&&"confirmed"!==d.status&&(h&&await g(h,d.tracking_number,j),i&&await g(i,d.tracking_number,k)),"in-transit"===c.status&&"in-transit"!==d.status)for(let a of l)await e(a,d.tracking_number,c.current_location||d.current_location||"Origin");if("delivered"===c.status&&"delivered"!==d.status)for(let a of l)await f(a,d.tracking_number)}}catch(a){console.error("Failed to send lifecycle email (non-critical):",a)}return(0,e.revalidatePath)("/admin"),{success:!0}}async function h(b,c,f=!1){let g=await (0,d.createClient)(),{data:i,error:j}=await g.from("shipments").select("*").eq("id",b).single();if(j||!i)return console.error("Error fetching shipment:",j),{error:"Failed to fetch shipment"};let k=[...i.history||[],{...c,timestamp:new Date().toISOString()}],l={status:c.status,current_location:c.location,history:k,updated_at:new Date().toISOString()};"confirmed"===c.status&&(l.payment_status="paid");let{error:m}=await g.from("shipments").update(l).eq("id",b);if(m)return console.error("Error updating shipment:",m),{error:"Failed to log event"};if(f)try{let{sendShipmentStatusUpdateEmail:b}=await a.A(74019),d=i.sender_info?.email,e=i.receiver_info?.email;for(let a of[d,e].filter(Boolean))await b(a,i.tracking_number,c.status,c.location,c.note)}catch(a){console.error("Failed to send status update email:",a)}return(0,e.revalidatePath)("/admin"),{success:!0}}async function i(a,b){return g(a,{payment_status:"paid"===b?"unpaid":"paid"})}async function j(a){let b=await (0,d.createClient)(),{error:c}=await b.from("shipments").delete().eq("id",a);return c?(console.error("Error deleting shipment:",c),{error:"Failed to delete shipment"}):((0,e.revalidatePath)("/admin"),{success:!0})}async function k(a=100){let b=await (0,d.createClient)(),{data:c,error:e}=await b.from("profiles").select("id, email, full_name, role, created_at").order("created_at",{ascending:!1}).limit(a);return e?(console.error("Error fetching users:",e),[]):c}async function l(b,c){let{createServiceClient:d}=await a.A(15412),f=d(),{error:g}=await f.from("profiles").update({role:c}).eq("id",b);return g?(console.error("Error updating role:",g),{error:"Failed to update user role"}):((0,e.revalidatePath)("/admin"),{success:!0})}async function m(b){let{createServiceClient:c}=await a.A(15412),d=c(),{data:f,error:g}=await d.auth.admin.createUser({email:b.email,password:b.password,email_confirm:!0,user_metadata:{full_name:b.fullName}});if(g||!f.user)return console.error("Error creating auth user:",g),{error:g?.message||"Failed to create user"};let{error:h}=await d.from("profiles").upsert({id:f.user.id,email:b.email,full_name:b.fullName,role:b.role,updated_at:new Date().toISOString()});return h?(console.error("Error updating profile:",h),{warning:"User created, but profile sync failed. Check role manually.",success:!0}):((0,e.revalidatePath)("/admin"),{success:!0})}(0,a.i(13095).ensureServerEntryExports)([f,g,h,i,j,k,l,m]),(0,c.registerServerReference)(f,"40f774832d930e6fd97dcc43c7a3b100de39254f6f",null),(0,c.registerServerReference)(g,"60b70e5d345c1c55c9d51722a54eb4d029e2319f13",null),(0,c.registerServerReference)(h,"700b4acd3fed7b1790c2e227d5433578c2c24fced0",null),(0,c.registerServerReference)(i,"6080b9755218c4378cc6ee3db25c25abe471367e79",null),(0,c.registerServerReference)(j,"40fd6e93b39dd985ae1380e80e499a16e9295b960a",null),(0,c.registerServerReference)(k,"4051a4397eb60e9ba5a9a49de7c6c95252495f2856",null),(0,c.registerServerReference)(l,"60b3c0ea9a339b5dc43eee9dcc5f415c9bd8e467ec",null),(0,c.registerServerReference)(m,"4092472c94f9fd42775606cd47ff12f60047ee17bb",null);var n=a.i(43908);a.s([],18765),a.i(18765),a.s(["4023fc5c56a08eded849c2b60f98760867ea10f3a0",()=>n.createShipment,"4025a0ee08735742c2e4d64b5ee759f70a786392ad",()=>b.getChatMessages,"4051a4397eb60e9ba5a9a49de7c6c95252495f2856",()=>k,"4092472c94f9fd42775606cd47ff12f60047ee17bb",()=>m,"40f774832d930e6fd97dcc43c7a3b100de39254f6f",()=>f,"40fd6e93b39dd985ae1380e80e499a16e9295b960a",()=>j,"601a54e1e61ebec4ee8d22d385482431483c383d59",()=>b.createChatSession,"60b3c0ea9a339b5dc43eee9dcc5f415c9bd8e467ec",()=>l,"60b70e5d345c1c55c9d51722a54eb4d029e2319f13",()=>g,"700b4acd3fed7b1790c2e227d5433578c2c24fced0",()=>h,"781dce578e8850f3344c600f141f5999ba6b9b7064",()=>b.sendChatMessage],69973)},74019,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__e29f7e89._.js"].map(b=>a.l(b))).then(()=>b(28725)))},15412,a=>{a.v(b=>Promise.all(["server/chunks/ssr/src_utils_supabase_service_ts_8dbb4b43._.js"].map(b=>a.l(b))).then(()=>b(88368)))}];

//# sourceMappingURL=_5f823ace._.js.map