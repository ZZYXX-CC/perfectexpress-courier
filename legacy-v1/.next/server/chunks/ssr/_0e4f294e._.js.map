{"version":3,"sources":["../../../../src/app/actions/chat.ts","../../../../src/app/actions/shipment.ts","../../../../.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\nexport type ChatSession = {\n    id: string\n    visitor_name: string\n    visitor_email: string\n    user_id: string | null\n    assigned_admin_id: string | null\n    status: 'active' | 'closed'\n    unread_count: number\n    last_message_at: string\n    created_at: string\n}\n\nexport type ChatMessage = {\n    id: string\n    session_id: string\n    sender_type: 'visitor' | 'admin'\n    sender_name: string | null\n    message: string\n    is_read: boolean\n    created_at: string\n}\n\n// Create a new chat session\nexport async function createChatSession(visitorName: string, visitorEmail: string) {\n    const supabase = await createClient()\n    \n    // Check if user is logged in\n    const { data: { user } } = await supabase.auth.getUser()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .insert({\n            visitor_name: visitorName,\n            visitor_email: visitorEmail,\n            user_id: user?.id || null,\n            status: 'active'\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error creating chat session:', error)\n        return { error: error.message }\n    }\n\n    return { success: true, session: data }\n}\n\n// Get chat session by ID\nexport async function getChatSession(sessionId: string) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .select('*')\n        .eq('id', sessionId)\n        .single()\n\n    if (error) {\n        console.error('Error fetching chat session:', error)\n        return null\n    }\n\n    return data as ChatSession\n}\n\n// Get all active chat sessions (for admin)\nexport async function getActiveChatSessions() {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .select('*')\n        .order('last_message_at', { ascending: false })\n\n    if (error) {\n        console.error('Error fetching chat sessions:', error)\n        return []\n    }\n\n    return data as ChatSession[]\n}\n\n// Send a chat message\nexport async function sendChatMessage(\n    sessionId: string, \n    message: string, \n    senderType: 'visitor' | 'admin',\n    senderName?: string\n) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_messages')\n        .insert({\n            session_id: sessionId,\n            sender_type: senderType,\n            sender_name: senderName,\n            message: message\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error sending message:', error)\n        return { error: error.message }\n    }\n\n    return { success: true, message: data }\n}\n\n// Get messages for a chat session\nexport async function getChatMessages(sessionId: string) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('session_id', sessionId)\n        .order('created_at', { ascending: true })\n\n    if (error) {\n        console.error('Error fetching messages:', error)\n        return []\n    }\n\n    return data as ChatMessage[]\n}\n\n// Close a chat session\nexport async function closeChatSession(sessionId: string) {\n    const supabase = await createClient()\n\n    const { error } = await supabase\n        .from('chat_sessions')\n        .update({ status: 'closed', updated_at: new Date().toISOString() })\n        .eq('id', sessionId)\n\n    if (error) {\n        console.error('Error closing chat session:', error)\n        return { error: error.message }\n    }\n\n    revalidatePath('/admin/chat')\n    return { success: true }\n}\n\n// Mark messages as read (for admin)\nexport async function markMessagesAsRead(sessionId: string) {\n    const supabase = await createClient()\n\n    // Mark all unread visitor messages as read\n    await supabase\n        .from('chat_messages')\n        .update({ is_read: true })\n        .eq('session_id', sessionId)\n        .eq('sender_type', 'visitor')\n        .eq('is_read', false)\n\n    // Reset unread count on session\n    await supabase\n        .from('chat_sessions')\n        .update({ unread_count: 0 })\n        .eq('id', sessionId)\n\n    return { success: true }\n}\n","'use server'\n\nimport { createClient } from '@/utils/supabase/server'\n\nexport type ShipmentFormData = {\n    sender_name: string\n    sender_email: string\n    sender_address: string\n    receiver_name: string\n    receiver_email: string\n    receiver_address: string\n    parcel_description: string\n    parcel_weight: string\n}\n\nexport async function createShipment(formData: ShipmentFormData) {\n    const supabase = await createClient()\n\n    // Check for logged-in user\n    const { data: { user } } = await supabase.auth.getUser()\n\n    const { data, error } = await supabase\n        .from('shipments')\n        .insert({\n            user_id: user?.id || null, // Link to user if authenticated\n            sender_info: {\n                name: formData.sender_name,\n                email: formData.sender_email,\n                address: formData.sender_address,\n            },\n            receiver_info: {\n                name: formData.receiver_name,\n                email: formData.receiver_email,\n                address: formData.receiver_address,\n            },\n            parcel_details: {\n                description: formData.parcel_description,\n                weight: formData.parcel_weight,\n            },\n            status: 'pending',\n            payment_status: 'unpaid',\n            history: [\n                {\n                    status: 'pending',\n                    location: 'System',\n                    timestamp: new Date().toISOString(),\n                    note: 'Shipment created'\n                }\n            ]\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error creating shipment:', error)\n        return { error: 'Failed to create shipment. Please try again.' }\n    }\n\n    // Trigger Email Notification (Non-blocking) - Notify BOTH sender and receiver\n    try {\n        const { sendShipmentCreatedEmail, sendShipmentReceiverNotification } = await import('@/lib/email')\n        \n        // Notify sender\n        await sendShipmentCreatedEmail(\n            formData.sender_email,\n            data?.tracking_number || 'N/A',\n            formData.sender_name\n        )\n        \n        // Notify receiver that a package is coming their way\n        if (formData.receiver_email) {\n            await sendShipmentReceiverNotification(\n                formData.receiver_email,\n                data?.tracking_number || 'N/A',\n                formData.receiver_name,\n                formData.sender_name\n            )\n        }\n    } catch (emailError) {\n        console.error('Failed to send creation email:', emailError)\n        // We don't fail the whole action if email fails\n    }\n\n    return { success: true, tracking_number: data.tracking_number }\n}\n","export {createChatSession as '601a54e1e61ebec4ee8d22d385482431483c383d59'} from 'ACTIONS_MODULE0'\nexport {sendChatMessage as '781dce578e8850f3344c600f141f5999ba6b9b7064'} from 'ACTIONS_MODULE0'\nexport {getChatMessages as '4025a0ee08735742c2e4d64b5ee759f70a786392ad'} from 'ACTIONS_MODULE0'\nexport {createShipment as '4023fc5c56a08eded849c2b60f98760867ea10f3a0'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"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"}