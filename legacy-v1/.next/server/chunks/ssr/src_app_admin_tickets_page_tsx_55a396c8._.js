module.exports=[48014,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(72036),e=a.i(5050);let f=(0,e.createServerReference)("00ad3389bc6e849e8e49280e3217eb7470b0717f05",e.callServer,void 0,e.findSourceMapURL,"getAllTickets"),g=(0,e.createServerReference)("40961d57596d15b186988c034e4b4cab8da2fd9b36",e.callServer,void 0,e.findSourceMapURL,"getTicketReplies");var h=a.i(1147);let i=(0,e.createServerReference)("608092312853408db614b5587d4866138db4bce027",e.callServer,void 0,e.findSourceMapURL,"updateTicketStatus"),j=(0,e.createServerReference)("60bb62346b4b393d76981d087157cde0e7045231a2",e.callServer,void 0,e.findSourceMapURL,"updateTicketPriority");var k=a.i(99570),l=a.i(66718),m=a.i(91119),n=a.i(86304),o=a.i(69876),p=a.i(23292),q=a.i(45903),r=a.i(73954),s=a.i(76971),t=a.i(92759),u=a.i(96221),v=a.i(41710),w=a.i(46842),x=a.i(92258),y=a.i(69520),z=a.i(87532),A=a.i(85264);let B=(0,a.i(70106).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var C=a.i(16201),D=a.i(63588);function E(){let[a,e]=(0,c.useState)([]),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)("all"),[O,P]=(0,c.useState)(!0),[Q,R]=(0,c.useTransition)(),S=(0,c.useRef)(null),T=(0,d.createClient)();(0,c.useEffect)(()=>{S.current?.scrollIntoView({behavior:"smooth"})},[G]);let U=(0,c.useCallback)(async()=>{e(await f()),P(!1)},[]);(0,c.useEffect)(()=>{U()},[U]),(0,c.useEffect)(()=>{let a=T.channel("admin-tickets").on("postgres_changes",{event:"*",schema:"public",table:"support_tickets"},()=>{U()}).subscribe();return()=>{T.removeChannel(a)}},[T,U]),(0,c.useEffect)(()=>{if(!E)return;let a=T.channel(`admin-ticket-${E.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"ticket_replies",filter:`ticket_id=eq.${E.id}`},a=>{let b=a.new;H(a=>a.some(a=>a.id===b.id)?a:[...a,b]),"customer"===b.sender_type&&p.toast.info("New reply from customer")}).subscribe();return()=>{T.removeChannel(a)}},[T,E]);let V=async a=>{F(a),P(!0),H(await g(a.id)),P(!1)},W=()=>{I.trim()&&E&&R(async()=>{let a=await (0,h.addTicketReply)({ticketId:E.id,message:I,senderType:"admin",senderName:"Support Team"});a.error?p.toast.error(a.error):(J(""),p.toast.success("Reply sent and customer notified"))})},X=a.filter(a=>{let b=a.ticket_number.toLowerCase().includes(K.toLowerCase())||a.subject.toLowerCase().includes(K.toLowerCase())||a.email.toLowerCase().includes(K.toLowerCase()),c="all"===M||a.status===M;return b&&c}),Y={total:a.length,open:a.filter(a=>"open"===a.status).length,inProgress:a.filter(a=>"in_progress"===a.status).length,resolved:a.filter(a=>"resolved"===a.status).length};return(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(q.default,{}),(0,b.jsxs)("main",{className:"container mx-auto px-4 pt-32 pb-20",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-secondary",children:"Admin Dashboard"}),(0,b.jsxs)("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[(0,b.jsx)(A.Wifi,{size:12,className:"animate-pulse"}),"Live"]})]}),(0,b.jsx)("p",{className:"text-slate-500",children:"Manage customer support requests"})]}),(0,b.jsxs)(k.Button,{variant:"outline",onClick:U,children:[(0,b.jsx)(y.RefreshCw,{className:"mr-2 h-4 w-4"}),"Refresh"]})]}),(0,b.jsx)(r.default,{}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,b.jsx)(m.Card,{className:"glass border-0 shadow-lg",children:(0,b.jsx)(m.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"Total"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-secondary",children:Y.total})]}),(0,b.jsx)(s.Ticket,{className:"text-slate-400",size:24})]})})}),(0,b.jsx)(m.Card,{className:"glass border-0 shadow-lg",children:(0,b.jsx)(m.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"Open"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:Y.open})]}),(0,b.jsx)(B,{className:"text-blue-400",size:24})]})})}),(0,b.jsx)(m.Card,{className:"glass border-0 shadow-lg",children:(0,b.jsx)(m.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"In Progress"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:Y.inProgress})]}),(0,b.jsx)(v.Clock,{className:"text-yellow-400",size:24})]})})}),(0,b.jsx)(m.Card,{className:"glass border-0 shadow-lg",children:(0,b.jsx)(m.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 uppercase",children:"Resolved"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:Y.resolved})]}),(0,b.jsx)(C.CheckCircle,{className:"text-green-400",size:24})]})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-400px)]",children:[(0,b.jsxs)(m.Card,{className:"glass border-0 shadow-lg overflow-hidden",children:[(0,b.jsxs)(m.CardHeader,{className:"border-b bg-slate-50/50 space-y-3",children:[(0,b.jsxs)(m.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,b.jsx)(s.Ticket,{size:20,className:"text-primary"}),"Tickets"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(z.Search,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,b.jsx)(l.Input,{placeholder:"Search...",className:"pl-8 h-9",value:K,onChange:a=>L(a.target.value)})]}),(0,b.jsxs)("select",{value:M,onChange:a=>N(a.target.value),className:"h-9 rounded-md border border-slate-200 bg-white px-2 text-sm",children:[(0,b.jsx)("option",{value:"all",children:"All"}),(0,b.jsx)("option",{value:"open",children:"Open"}),(0,b.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,b.jsx)("option",{value:"resolved",children:"Resolved"}),(0,b.jsx)("option",{value:"closed",children:"Closed"})]})]})]}),(0,b.jsx)(o.ScrollArea,{className:"h-[calc(100%-120px)]",children:(0,b.jsx)("div",{className:"p-2",children:0===X.length?(0,b.jsxs)("div",{className:"text-center py-12 text-slate-400",children:[(0,b.jsx)(s.Ticket,{size:40,className:"mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No tickets found"})]}):X.map(a=>(0,b.jsxs)("button",{onClick:()=>V(a),className:`w-full p-3 rounded-lg text-left mb-2 transition-colors ${E?.id===a.id?"bg-primary/10 border border-primary/20":"hover:bg-slate-100"}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("span",{className:"font-mono text-xs text-primary",children:a.ticket_number}),(0,b.jsx)(n.Badge,{variant:"outline",className:`text-xs ${(a=>{switch(a){case"open":return"bg-blue-100 text-blue-700 border-blue-200";case"in_progress":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"resolved":return"bg-green-100 text-green-700 border-green-200";case"closed":return"bg-slate-100 text-slate-700 border-slate-200";default:return"bg-slate-100 text-slate-700"}})(a.status)}`,children:a.status.replace("_"," ")})]}),(0,b.jsx)("p",{className:"font-medium text-secondary text-sm truncate",children:a.subject}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1",children:[(0,b.jsx)(w.User,{size:10}),(0,b.jsx)("span",{className:"truncate",children:a.name})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,b.jsx)("span",{className:"text-xs text-slate-400",children:new Date(a.updated_at).toLocaleDateString()}),(0,b.jsx)(n.Badge,{className:`text-xs ${(a=>{switch(a){case"urgent":return"bg-red-100 text-red-700";case"high":return"bg-orange-100 text-orange-700";case"normal":default:return"bg-slate-100 text-slate-700";case"low":return"bg-slate-50 text-slate-500"}})(a.priority)}`,children:a.priority})]})]},a.id))})})]}),(0,b.jsx)(m.Card,{className:"lg:col-span-2 glass border-0 shadow-lg overflow-hidden flex flex-col",children:E?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.CardHeader,{className:"border-b bg-slate-50/50",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center gap-2 mb-1",children:(0,b.jsx)("span",{className:"font-mono text-primary font-bold",children:E.ticket_number})}),(0,b.jsx)(m.CardTitle,{className:"text-lg",children:E.subject}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-slate-500",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(w.User,{size:14}),E.name]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(x.Mail,{size:14}),E.email]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)("select",{value:E.status,onChange:a=>{var b;return b=a.target.value,void(E&&R(async()=>{let a=await i(E.id,b);a.error?p.toast.error(a.error):(F({...E,status:b}),p.toast.success("Status updated"))}))},className:"h-8 rounded-md border border-slate-200 bg-white px-2 text-sm",children:[(0,b.jsx)("option",{value:"open",children:"Open"}),(0,b.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,b.jsx)("option",{value:"resolved",children:"Resolved"}),(0,b.jsx)("option",{value:"closed",children:"Closed"})]}),(0,b.jsxs)("select",{value:E.priority,onChange:a=>{var b;return b=a.target.value,void(E&&R(async()=>{let a=await j(E.id,b);a.error?p.toast.error(a.error):(F({...E,priority:b}),p.toast.success("Priority updated"))}))},className:"h-8 rounded-md border border-slate-200 bg-white px-2 text-sm",children:[(0,b.jsx)("option",{value:"low",children:"Low"}),(0,b.jsx)("option",{value:"normal",children:"Normal"}),(0,b.jsx)("option",{value:"high",children:"High"}),(0,b.jsx)("option",{value:"urgent",children:"Urgent"})]})]})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50",children:[O?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)(u.Loader2,{className:"h-6 w-6 animate-spin text-slate-400"})}):0===G.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[(0,b.jsx)(D.MessageSquare,{size:40,className:"mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No messages yet"})]}):G.map(a=>(0,b.jsx)("div",{className:`flex ${"admin"===a.sender_type?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] rounded-2xl px-4 py-2 ${"admin"===a.sender_type?"bg-primary text-white rounded-br-md":"bg-white text-slate-800 shadow-sm border rounded-bl-md"}`,children:[(0,b.jsx)("p",{className:`text-xs font-medium mb-1 ${"admin"===a.sender_type?"text-white/80":"text-primary"}`,children:a.sender_name||("admin"===a.sender_type?"Support":"Customer")}),(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.message}),(0,b.jsx)("p",{className:`text-xs mt-1 ${"admin"===a.sender_type?"text-white/60":"text-slate-400"}`,children:new Date(a.created_at).toLocaleString()})]})},a.id)),(0,b.jsx)("div",{ref:S})]}),"closed"!==E.status&&(0,b.jsxs)("div",{className:"p-4 border-t bg-white",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(l.Input,{value:I,onChange:a=>J(a.target.value),placeholder:"Type your reply...",className:"flex-1",disabled:Q,onKeyDown:a=>"Enter"===a.key&&!a.shiftKey&&W()}),(0,b.jsx)(k.Button,{onClick:W,disabled:Q||!I.trim(),children:Q?(0,b.jsx)(u.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Send,{size:18,className:"mr-2"}),"Send"]})})]}),(0,b.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:"Customer will be notified by email"})]})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-slate-400",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(s.Ticket,{size:60,className:"mx-auto mb-4 opacity-30"}),(0,b.jsx)("p",{className:"text-lg",children:"Select a ticket"}),(0,b.jsx)("p",{className:"text-sm",children:"Choose a ticket from the list to view details"})]})})})]})]})]})}a.s(["default",()=>E],48014)}];

//# sourceMappingURL=src_app_admin_tickets_page_tsx_55a396c8._.js.map