module.exports=[31726,a=>{"use strict";var b=a.i(37936),c=a.i(22176),d=a.i(18558);async function e(a,b){let d=await (0,c.createClient)(),{data:{user:e}}=await d.auth.getUser(),{data:f,error:g}=await d.from("chat_sessions").insert({visitor_name:a,visitor_email:b,user_id:e?.id||null,status:"active"}).select().single();return g?(console.error("Error creating chat session:",g),{error:g.message}):{success:!0,session:f}}async function f(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("chat_sessions").select("*").eq("id",a).single();return e?(console.error("Error fetching chat session:",e),null):d}async function g(){let a=await (0,c.createClient)(),{data:b,error:d}=await a.from("chat_sessions").select("*").order("last_message_at",{ascending:!1});return d?(console.error("Error fetching chat sessions:",d),[]):b}async function h(a,b,d,e){let f=await (0,c.createClient)(),{data:g,error:h}=await f.from("chat_messages").insert({session_id:a,sender_type:d,sender_name:e,message:b}).select().single();return h?(console.error("Error sending message:",h),{error:h.message}):{success:!0,message:g}}async function i(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("chat_messages").select("*").eq("session_id",a).order("created_at",{ascending:!0});return e?(console.error("Error fetching messages:",e),[]):d}async function j(a){let b=await (0,c.createClient)(),{error:e}=await b.from("chat_sessions").update({status:"closed",updated_at:new Date().toISOString()}).eq("id",a);return e?(console.error("Error closing chat session:",e),{error:e.message}):((0,d.revalidatePath)("/admin/chat"),{success:!0})}async function k(a){let b=await (0,c.createClient)();return await b.from("chat_messages").update({is_read:!0}).eq("session_id",a).eq("sender_type","visitor").eq("is_read",!1),await b.from("chat_sessions").update({unread_count:0}).eq("id",a),{success:!0}}(0,a.i(13095).ensureServerEntryExports)([e,f,g,h,i,j,k]),(0,b.registerServerReference)(e,"601a54e1e61ebec4ee8d22d385482431483c383d59",null),(0,b.registerServerReference)(f,"40ae27ffaf22b8950880e72d49cdd11a2f48da0940",null),(0,b.registerServerReference)(g,"009a18ceb083bab5ad24884d10753cc89c6b893002",null),(0,b.registerServerReference)(h,"781dce578e8850f3344c600f141f5999ba6b9b7064",null),(0,b.registerServerReference)(i,"4025a0ee08735742c2e4d64b5ee759f70a786392ad",null),(0,b.registerServerReference)(j,"40ceed2991eeb6f8616fabb5f58d0ee2f68e273e4d",null),(0,b.registerServerReference)(k,"40007ca5d3341f9372d0ec690a3592d7880edcaa5e",null),a.s(["closeChatSession",()=>j,"createChatSession",()=>e,"getActiveChatSessions",()=>g,"getChatMessages",()=>i,"markMessagesAsRead",()=>k,"sendChatMessage",()=>h])},37196,a=>{"use strict";var b=a.i(37936),c=a.i(22176),d=a.i(18558);async function e(a){let b=await (0,c.createClient)(),{data:{user:d}}=await b.auth.getUser(),{data:e,error:f}=await b.from("support_tickets").insert({user_id:d?.id||null,name:a.name,email:a.email,subject:a.subject,priority:a.priority||"normal",status:"open"}).select().single();if(f)return console.error("Error creating ticket:",f),{error:f.message};let{error:g}=await b.from("ticket_replies").insert({ticket_id:e.id,sender_type:"customer",sender_name:a.name,message:a.message});return g&&console.error("Error adding initial message:",g),{success:!0,ticket:e}}async function f(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("support_tickets").select("*").eq("id",a).single();return e?(console.error("Error fetching ticket:",e),null):d}async function g(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("support_tickets").select("*").eq("ticket_number",a).single();return e?(console.error("Error fetching ticket:",e),null):d}async function h(){let a=await (0,c.createClient)(),{data:b,error:d}=await a.from("support_tickets").select("*").order("updated_at",{ascending:!1});return d?(console.error("Error fetching tickets:",d),[]):b}async function i(){let a=await (0,c.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return[];let{data:d,error:e}=await a.from("support_tickets").select("*").or(`user_id.eq.${b.id},email.eq.${b.email}`).order("updated_at",{ascending:!1});return e?(console.error("Error fetching user tickets:",e),[]):d}async function j(a){let b=await (0,c.createClient)(),{data:d,error:e}=await b.from("ticket_replies").select("*").eq("ticket_id",a).order("created_at",{ascending:!0});return e?(console.error("Error fetching replies:",e),[]):d}async function k(b){let e=await (0,c.createClient)(),{data:g,error:h}=await e.from("ticket_replies").insert({ticket_id:b.ticketId,sender_type:b.senderType,sender_name:b.senderName,message:b.message}).select().single();if(h)return console.error("Error adding reply:",h),{error:h.message};try{let c=await f(b.ticketId);if(c){let{sendTicketReplyNotification:d}=await a.A(74019);"admin"===b.senderType?await d(c.email,c.ticket_number,c.subject,b.message,"admin"):console.log("Customer replied to ticket:",c.ticket_number)}}catch(a){console.error("Failed to send notification email:",a)}return(0,d.revalidatePath)(`/support/${b.ticketId}`),(0,d.revalidatePath)("/admin/tickets"),{success:!0,reply:g}}async function l(a,b){let e=await (0,c.createClient)(),{error:f}=await e.from("support_tickets").update({status:b,updated_at:new Date().toISOString()}).eq("id",a);return f?(console.error("Error updating ticket status:",f),{error:f.message}):((0,d.revalidatePath)("/admin/tickets"),{success:!0})}async function m(a,b){let e=await (0,c.createClient)(),{error:f}=await e.from("support_tickets").update({priority:b,updated_at:new Date().toISOString()}).eq("id",a);return f?(console.error("Error updating ticket priority:",f),{error:f.message}):((0,d.revalidatePath)("/admin/tickets"),{success:!0})}(0,a.i(13095).ensureServerEntryExports)([e,f,g,h,i,j,k,l,m]),(0,b.registerServerReference)(e,"40b121c4d42d3a64eb159542d6dc3a5574fe470055",null),(0,b.registerServerReference)(f,"4034ae4a9f305f57b2e8bf0a348dc1e6cd09ca9947",null),(0,b.registerServerReference)(g,"4091ccdca2a43602e1fafc6d8999024ef00bd17721",null),(0,b.registerServerReference)(h,"00ad3389bc6e849e8e49280e3217eb7470b0717f05",null),(0,b.registerServerReference)(i,"00e748acc27b9f533a514cfb222438c8691aa7823a",null),(0,b.registerServerReference)(j,"40961d57596d15b186988c034e4b4cab8da2fd9b36",null),(0,b.registerServerReference)(k,"40224a9559beab856ec27d04f090cab3d0a1b4ddfa",null),(0,b.registerServerReference)(l,"608092312853408db614b5587d4866138db4bce027",null),(0,b.registerServerReference)(m,"60bb62346b4b393d76981d087157cde0e7045231a2",null),a.s(["addTicketReply",()=>k,"createTicket",()=>e,"getAllTickets",()=>h,"getTicket",()=>f,"getTicketByNumber",()=>g,"getTicketReplies",()=>j,"getUserTickets",()=>i,"updateTicketPriority",()=>m,"updateTicketStatus",()=>l])},79416,a=>{"use strict";var b=a.i(31726),c=a.i(37196);a.s([],222),a.i(222),a.s(["00e748acc27b9f533a514cfb222438c8691aa7823a",()=>c.getUserTickets,"4025a0ee08735742c2e4d64b5ee759f70a786392ad",()=>b.getChatMessages,"40b121c4d42d3a64eb159542d6dc3a5574fe470055",()=>c.createTicket,"601a54e1e61ebec4ee8d22d385482431483c383d59",()=>b.createChatSession,"781dce578e8850f3344c600f141f5999ba6b9b7064",()=>b.sendChatMessage],79416)},74019,a=>{a.v(b=>Promise.all(["server/chunks/ssr/[root-of-the-server]__e29f7e89._.js"].map(b=>a.l(b))).then(()=>b(28725)))}];

//# sourceMappingURL=_ac62bba4._.js.map