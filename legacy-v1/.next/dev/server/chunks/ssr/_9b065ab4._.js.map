{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Patriot%202TB/Dev%20Test/perfectexpress-courier/src/utils/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport { Database } from '@/types/database.types'\n\nexport async function createClient() {\n    const cookieStore = await cookies()\n\n    return createServerClient<Database>(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n        {\n            cookies: {\n                getAll() {\n                    return cookieStore.getAll()\n                },\n                setAll(cookiesToSet) {\n                    try {\n                        cookiesToSet.forEach(({ name, value, options }) =>\n                            cookieStore.set(name, value, options)\n                        )\n                    } catch {\n                        // The `setAll` method was called from a Server Component.\n                        // This can be ignored if you have middleware refreshing\n                        // user sessions.\n                    }\n                },\n            },\n        }\n    )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAGO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACrB;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Patriot%202TB/Dev%20Test/perfectexpress-courier/src/app/actions/chat.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\nexport type ChatSession = {\n    id: string\n    visitor_name: string\n    visitor_email: string\n    user_id: string | null\n    assigned_admin_id: string | null\n    status: 'active' | 'closed'\n    unread_count: number\n    last_message_at: string\n    created_at: string\n}\n\nexport type ChatMessage = {\n    id: string\n    session_id: string\n    sender_type: 'visitor' | 'admin'\n    sender_name: string | null\n    message: string\n    is_read: boolean\n    created_at: string\n}\n\n// Create a new chat session\nexport async function createChatSession(visitorName: string, visitorEmail: string) {\n    const supabase = await createClient()\n    \n    // Check if user is logged in\n    const { data: { user } } = await supabase.auth.getUser()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .insert({\n            visitor_name: visitorName,\n            visitor_email: visitorEmail,\n            user_id: user?.id || null,\n            status: 'active'\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error creating chat session:', error)\n        return { error: error.message }\n    }\n\n    return { success: true, session: data }\n}\n\n// Get chat session by ID\nexport async function getChatSession(sessionId: string) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .select('*')\n        .eq('id', sessionId)\n        .single()\n\n    if (error) {\n        console.error('Error fetching chat session:', error)\n        return null\n    }\n\n    return data as ChatSession\n}\n\n// Get all active chat sessions (for admin)\nexport async function getActiveChatSessions() {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_sessions')\n        .select('*')\n        .order('last_message_at', { ascending: false })\n\n    if (error) {\n        console.error('Error fetching chat sessions:', error)\n        return []\n    }\n\n    return data as ChatSession[]\n}\n\n// Send a chat message\nexport async function sendChatMessage(\n    sessionId: string, \n    message: string, \n    senderType: 'visitor' | 'admin',\n    senderName?: string\n) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_messages')\n        .insert({\n            session_id: sessionId,\n            sender_type: senderType,\n            sender_name: senderName,\n            message: message\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error sending message:', error)\n        return { error: error.message }\n    }\n\n    return { success: true, message: data }\n}\n\n// Get messages for a chat session\nexport async function getChatMessages(sessionId: string) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase\n        .from('chat_messages')\n        .select('*')\n        .eq('session_id', sessionId)\n        .order('created_at', { ascending: true })\n\n    if (error) {\n        console.error('Error fetching messages:', error)\n        return []\n    }\n\n    return data as ChatMessage[]\n}\n\n// Close a chat session\nexport async function closeChatSession(sessionId: string) {\n    const supabase = await createClient()\n\n    const { error } = await supabase\n        .from('chat_sessions')\n        .update({ status: 'closed', updated_at: new Date().toISOString() })\n        .eq('id', sessionId)\n\n    if (error) {\n        console.error('Error closing chat session:', error)\n        return { error: error.message }\n    }\n\n    revalidatePath('/admin/chat')\n    return { success: true }\n}\n\n// Mark messages as read (for admin)\nexport async function markMessagesAsRead(sessionId: string) {\n    const supabase = await createClient()\n\n    // Mark all unread visitor messages as read\n    await supabase\n        .from('chat_messages')\n        .update({ is_read: true })\n        .eq('session_id', sessionId)\n        .eq('sender_type', 'visitor')\n        .eq('is_read', false)\n\n    // Reset unread count on session\n    await supabase\n        .from('chat_sessions')\n        .update({ unread_count: 0 })\n        .eq('id', sessionId)\n\n    return { success: true }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Patriot%202TB/Dev%20Test/perfectexpress-courier/src/app/actions/shipment.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/utils/supabase/server'\n\nexport type ShipmentFormData = {\n    sender_name: string\n    sender_email: string\n    sender_address: string\n    receiver_name: string\n    receiver_email: string\n    receiver_address: string\n    parcel_description: string\n    parcel_weight: string\n}\n\nexport async function createShipment(formData: ShipmentFormData) {\n    const supabase = await createClient()\n\n    // Check for logged-in user\n    const { data: { user } } = await supabase.auth.getUser()\n\n    const { data, error } = await supabase\n        .from('shipments')\n        .insert({\n            user_id: user?.id || null, // Link to user if authenticated\n            sender_info: {\n                name: formData.sender_name,\n                email: formData.sender_email,\n                address: formData.sender_address,\n            },\n            receiver_info: {\n                name: formData.receiver_name,\n                email: formData.receiver_email,\n                address: formData.receiver_address,\n            },\n            parcel_details: {\n                description: formData.parcel_description,\n                weight: formData.parcel_weight,\n            },\n            status: 'pending',\n            payment_status: 'unpaid',\n            history: [\n                {\n                    status: 'pending',\n                    location: 'System',\n                    timestamp: new Date().toISOString(),\n                    note: 'Shipment created'\n                }\n            ]\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Error creating shipment:', error)\n        return { error: 'Failed to create shipment. Please try again.' }\n    }\n\n    // Trigger Email Notification (Non-blocking) - Notify BOTH sender and receiver\n    try {\n        const { sendShipmentCreatedEmail, sendShipmentReceiverNotification } = await import('@/lib/email')\n        \n        // Notify sender\n        await sendShipmentCreatedEmail(\n            formData.sender_email,\n            data?.tracking_number || 'N/A',\n            formData.sender_name\n        )\n        \n        // Notify receiver that a package is coming their way\n        if (formData.receiver_email) {\n            await sendShipmentReceiverNotification(\n                formData.receiver_email,\n                data?.tracking_number || 'N/A',\n                formData.receiver_name,\n                formData.sender_name\n            )\n        }\n    } catch (emailError) {\n        console.error('Failed to send creation email:', emailError)\n        // We don't fail the whole action if email fails\n    }\n\n    return { success: true, tracking_number: data.tracking_number }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;AAaO,eAAe,eAAe,QAA0B;IAC3D,MAAM,WAAW,MAAM,IAAA,kJAAY;IAEnC,2BAA2B;IAC3B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAEtD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SACzB,IAAI,CAAC,aACL,MAAM,CAAC;QACJ,SAAS,MAAM,MAAM;QACrB,aAAa;YACT,MAAM,SAAS,WAAW;YAC1B,OAAO,SAAS,YAAY;YAC5B,SAAS,SAAS,cAAc;QACpC;QACA,eAAe;YACX,MAAM,SAAS,aAAa;YAC5B,OAAO,SAAS,cAAc;YAC9B,SAAS,SAAS,gBAAgB;QACtC;QACA,gBAAgB;YACZ,aAAa,SAAS,kBAAkB;YACxC,QAAQ,SAAS,aAAa;QAClC;QACA,QAAQ;QACR,gBAAgB;QAChB,SAAS;YACL;gBACI,QAAQ;gBACR,UAAU;gBACV,WAAW,IAAI,OAAO,WAAW;gBACjC,MAAM;YACV;SACH;IACL,GACC,MAAM,GACN,MAAM;IAEX,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,OAAO;QAA+C;IACnE;IAEA,8EAA8E;IAC9E,IAAI;QACA,MAAM,EAAE,wBAAwB,EAAE,gCAAgC,EAAE,GAAG;QAEvE,gBAAgB;QAChB,MAAM,yBACF,SAAS,YAAY,EACrB,MAAM,mBAAmB,OACzB,SAAS,WAAW;QAGxB,qDAAqD;QACrD,IAAI,SAAS,cAAc,EAAE;YACzB,MAAM,iCACF,SAAS,cAAc,EACvB,MAAM,mBAAmB,OACzB,SAAS,aAAa,EACtB,SAAS,WAAW;QAE5B;IACJ,EAAE,OAAO,YAAY;QACjB,QAAQ,KAAK,CAAC,kCAAkC;IAChD,gDAAgD;IACpD;IAEA,OAAO;QAAE,SAAS;QAAM,iBAAiB,KAAK,eAAe;IAAC;AAClE;;;IArEsB;;AAAA,+OAAA"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Patriot%202TB/Dev%20Test/perfectexpress-courier/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createChatSession as '60b514bc9dac2e166e161835b73dc28240aa517c38'} from 'ACTIONS_MODULE0'\nexport {sendChatMessage as '780cfad9819c039b2b6996bc6154909a571b1535f1'} from 'ACTIONS_MODULE0'\nexport {getChatMessages as '4014455e22b76c012584d01728b3a7e44c3d3f72fe'} from 'ACTIONS_MODULE0'\nexport {createShipment as '40b1785065668ace62bf3dd06a6fc5312095acdac4'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAGA"}}]
}